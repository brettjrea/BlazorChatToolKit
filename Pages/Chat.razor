@page "/chat"
@using System.Net.Http
@using System.Net.Http.Json
@inject HttpClient Http
@using Microsoft.JSInterop
@inject IJSRuntime JSRuntime;


<h3>Chat</h3>

<div>
    <input @bind="InputText" placeholder="Enter your message" />
    <button @onclick="SendMessage">Send</button>
</div>

<div>
    <h4>Response:</h4>
    <p>@OutputText</p>
</div>

@code {
    private string InputText { get; set; } = string.Empty;
    private string OutputText { get; set; } = string.Empty;

    private async Task SendMessage()
    {
        var data = new { input = InputText };
        var response = await Http.PostAsJsonAsync("http://127.0.0.1:5000/chat", data);

        // Log the status code and content to the browser console
        await JSRuntime.InvokeVoidAsync("console.log", $"Status code: {response.StatusCode}");
        var content = await response.Content.ReadAsStringAsync();
        await JSRuntime.InvokeVoidAsync("console.log", $"Content: {content}");

        var result = await response.Content.ReadFromJsonAsync<ApiResponse>();
        OutputText = result.Output;
    }


    public class ApiResponse
    {
        public string Output { get; set; }
    }
}
